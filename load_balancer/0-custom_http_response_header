#!/usr/bin/env bash
# This script installs and configures Nginx to add a custom HTTP response header X-Served-By with the server hostname

# Exit on error
set -e

# Update and install nginx
apt-get update -y
apt-get install -y nginx

# Replace the default index page
echo "Holberton School for the win!" > /var/www/html/index.nginx-debian.html

# Get the server hostname
HOSTNAME=$(hostname)

# Insert the custom header into the default Nginx config
# This ensures that each response has X-Served-By: <hostname>
sed -i "/server_name _;/a \\tadd_header X-Served-By \$HOSTNAME;" /etc/nginx/sites-available/default

# Restart nginx without systemctl
service nginx restart

